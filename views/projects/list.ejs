<%- include('../partials/header'); %>

<%- include('../partials/topbar'); %>
<div class="px-3 py-3">
  <h2>Projects</h2>
  <hr>
  <h4>Filters</h4>
  <div id="filterform" class="container">
    <form action="/projects" method="GET" id="browse">
      <div>
        <div class="form-check">
          <div class="d-flex flex-row mb-3">
            <div class="container w-25">
              <input type="checkbox" class="form-check-input" name="checkprojectid">
              <label class="form-check-label" for="ID">ID</label>
            </div>
            <div class="container">
              <input class="form-control" type="number" name="projectid" step="1" placeholder="ID">
            </div>
          </div>
        </div>
        <div class="form-check">
          <div class="d-flex flex-row mb-3">
            <div class="container w-25">
              <input type="checkbox" class="form-check-input" name="checkname">
              <label class="form-check-label" for="Name">Name</label>
            </div>
            <div class="container">
              <input class="form-control" type="text" name="name" placeholder="Name">
            </div>
          </div>
        </div>
        <div class="form-check">
          <div class="d-flex flex-row mb-3">
            <div class="container w-25">
              <input type="checkbox" class="form-check-input" name="checkmember">
              <label class="form-check-label" for="Member">Member</label>
            </div>
            <div class="container">
              <select class="form-control" id="inputMember" name="member">
                <option disabled selected> Choose the member ...</option>
                <% members.forEach( (el) => { %>
                <option value="<%= el.firstname %>"><%= el.firstname %></option>
                <%  }) %>
              </select>
            </div>
          </div>
        </div>
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>
  </div>
  <h4>Options</h4>

  <div>
    <form action="/projects/option" method="POST">
      <div class="d-flex">
        <h6>Columns</h6>
        <div>
          <div class="form-check">
            <div class="mb-3">
              <div class="container w-25">
                <input type="checkbox" class="form-check-input" <%= option.projectid ? 'checked' : '' %>
                  name="optionprojectid">
                <label class="form-check-label" for="ID">ID</label>
              </div>
            </div>
          </div>
          <div class="form-check">
            <div class="mb-3">
              <div class="container w-25">
                <input type="checkbox" class="form-check-input" <%= option.name ? 'checked' : '' %> name="optionname">
                <label class="form-check-label" for="Name">Name</label>
              </div>
            </div>
          </div>
          <div class="form-check">
            <div class="mb-3">
              <div class="container w-25">
                <input type="checkbox" class="form-check-input" <%= option.members ? 'checked' : '' %>
                  name="optionmembers">
                <label class="form-check-label" for="Members">Members</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="btn btn-primary" type="submit">Apply</button>
    </form>
  </div>
  <div class="container mt-3">
    <table class="table table-striped">
      <thead>
        <tr>
          <th <%= option.projectid ? '' : 'hidden' %>>
            <div>#</div>
            <div>
              <a href="<%= `/projects/?${query}&sortp=projectid&sortr=ASC` %>"
                class="arrow arrow-up <%= (sort.prop === 'projectid' && sort.rule === 'ASC') ? 'arrow-up-active' : '' %>"></a>
              <a href="<%= `/projects/?${query}&sortp=projectid&sortr=DESC` %>"
                class="arrow arrow-down <%= (sort.prop === 'projectid' && sort.rule === 'DESC') ? 'arrow-down-active' : '' %>"></a>
            </div>
          </th>
          <th <%= option.name ? '' : 'hidden' %>>
            <div>Name</div>
            <div>
              <a href="<%= `/projects/?${query}&sortp=name&sortr=ASC` %>"
                class="arrow arrow-up <%= (sort.prop === 'name' && sort.rule === 'ASC') ? 'arrow-up-active' : '' %>"></a>
              <a href="<%= `/projects/?${query}&sortp=name&sortr=DESC` %>"
                class="arrow arrow-down <%= (sort.prop === 'name' && sort.rule === 'DESC') ? 'arrow-down-active' : '' %>"></a>
            </div>
          </th>
          <th <%= option.members ? '' : 'hidden' %>>
            <div>Members</div>
            <div>
              <a href="<%= `/projects/?${query}&sortp=members&sortr=ASC` %>"
                class="arrow arrow-up <%= (sort.prop === 'members' && sort.rule === 'ASC') ? 'arrow-up-active' : '' %>"></a>
              <a href="<%= `/projects/?${query}&sortp=members&sortr=DESC` %>"
                class="arrow arrow-down <%= (sort.prop === 'members' && sort.rule === 'DESC') ? 'arrow-down-active' : '' %>"></a>
            </div>
          </th>
          <th <%= option.projectid || option.name || option.members ? '' : 'hidden' %>>
            <div>Actions</div>
          </th>
          </th>
        </tr>
      </thead>
      <tbody id="tdata">
        <% let p = isNaN(parseInt(result.page)) || parseInt(result.page) === 0 ? 1 : parseInt(result.page); %>
        <% let list = result.data %>
        <% list.forEach((el, index) =>{ 
              %>
        <tr>
          <td <%= option.projectid ? '' : 'hidden' %>><%= el.projectid || '' %></td>
          <td <%= option.name ? '' : 'hidden' %>><%= el.name || '' %></td>
          <td <%= option.members ? '' : 'hidden' %>><%= el.members || '' %></td>
          <td <%= option.projectid || option.name || option.members ? '' : 'hidden' %>>
            <div>
              <a href="/projects/edit/<%= el.projectid %>" class="btn btn-success">Edit</a>
              <a href="/projects/delete/<%= el.projectid %>" class="btn btn-danger">Delete</a>
            </div>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <nav>
      <p id="pagenumber"></p>
      <p id="filters"></p>
      <p id="sortp"></p>
      <p id="sortr"></p>
      <ul id="page" class="pagination mt-2">
        <% let size = Math.ceil(result.total / 3) %>
        <% if (p > 1) { %>
        <li class="page-item"><a class="page-link"
            href="<%= `/projects?page=${p > 1 ? p-1 : 1}&${query}${query.length > 0 ? '&' : ''}sortp=${sort.prop}&sortr=${sort.rule}` %>">Previous</a>
        </li>
        <% }%>
        <% for (let i = 0; i < size; i++) { %>
        <li class="page-item"><a class="page-link"
            href="<%= `/projects?page=${i+1}&${query}${query.length > 0 ? '&' : ''}sortp=${sort.prop}&sortr=${sort.rule}` %>"><%=i+1%></a>
        </li>
        <%}%>
        <% if (p < size) { %>
        <li class="page-item"><a class="page-link"
            href="<%= `/projects?page=${p < size ? p+1 : size}&${query}${query.length > 0 ? '&' : ''}sortp=${sort.prop}&sortr=${sort.rule}` %>">Next</a>
        </li>
        <% }%>
      </ul>
    </nav>
    <button id="addbutton" class="btn btn-primary" type="button">Add</button>
  </div>
  <div style="display: none;" id="fillformcontainer" class="container mt-3">
    <h3 id="formtitle"></h3>
    <form id="fillform">
      <div>
        <div id="idfill" style="display: none;">
          <div class="d-flex flex-row mb-3">
            <div class="container w-25">
              <label class="form-check-label" for="ID">ID</label>
            </div>
            <div class="container">
              <input id="idform" disabled class="form-control" type="number" name="id" step="1" placeholder="ID">
            </div>
          </div>
        </div>
        <div class="d-flex flex-row mb-3">
          <div class="container w-25">
            <label class="form-check-label" for="String">String</label>
          </div>
          <div class="container">
            <input id="stringform" class="form-control" type="text" name="string" placeholder="String">
          </div>
        </div>
        <div class="d-flex flex-row mb-3">
          <div class="container w-25">
            <label class="form-check-label" for="Integer">Integer</label>
          </div>
          <div class="container">
            <input id="integerform" class="form-control" type="number" name="integer" placeholder="Integer">
          </div>
        </div>
        <div class="d-flex flex-row mb-3">
          <div class="container w-25">
            <label class="form-check-label" for="Float">Float</label>
          </div>
          <div class="container">
            <input id="floatform" class="form-control" type="number" name="float" step="any" placeholder="Float">
          </div>
        </div>
        <div class="d-flex flex-row mb-3">
          <div class="container w-25">
            <label class="form-check-label" for="Date">Date</label>
          </div>
          <div class="container">
            <div>
              <input id="dateform" class="form-control" type="date" name="date">
            </div>
          </div>
        </div>
        <div class="d-flex flex-row mb-3">
          <div class="container w-25">
            <label class="form-check-label" for="Boolean">Boolean</label>
          </div>
          <div class="container">
            <select id="booleanform" class="form-control" id="inputBoolean" name="boolean">
              <option disabled selected value=""> Choose the boolean ...</option>
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </div>
        </div>
        <button id="submitfillform" class="btn btn-primary" type="submit"></button>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/footer'); %>